#ifdef C
#include <stdio.h>
#endif
typedef unsigned char uint8_t;

int abs(int a)
{
	if (a < 0)
		return -a;
	else
		return a;
}

static int x264_pixel_sad_16x16( uint8_t *pix1, int i_stride_pix1,
		uint8_t *pix2, int i_stride_pix2 ) 
{                                                   
	int i_sum = 0;                                  
	int x, y;                                       
	for( y = 0; y < 16; y++ )                       
	{                                               
		for( x = 0; x < 16; x++ )                   
		{                                           
			i_sum += abs( pix1[x] - pix2[x] );      
		}                                           
		pix1 += i_stride_pix1;                      
		pix2 += i_stride_pix2;                      
	}                                               
	return i_sum;                                   
}

static void x264_pixel_sad_x4_16x16( uint8_t *fenc, uint8_t *pix0, uint8_t *pix1, 
		uint8_t *pix2, uint8_t *pix3, int i_stride, int scores[4] )
{
	scores[0] = x264_pixel_sad_16x16( fenc, 16, pix0, i_stride );
	scores[1] = x264_pixel_sad_16x16( fenc, 16, pix1, i_stride );
	scores[2] = x264_pixel_sad_16x16( fenc, 16, pix2, i_stride );
	scores[3] = x264_pixel_sad_16x16( fenc, 16, pix3, i_stride );
}

uint8_t fenc[16*16] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,
						0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};

    uint8_t pix0[16*16] = {0,11,22,33,44,55,66,77,88,99,10,111,212,13,14,15,
                           10,21,32,43,54,65,76,87,98,9,110,211,112,13,14,15,
                           20,31,42,53,64,75,86,97,8,19,210,311,212,13,14,15,
                           10,21,42,34,44,55,66,77,88,99,110,211,142,13,14,15,
                           20,41,52,3,4,5,6,7,8,9,10,11,12,113,149,151,
                           30,61,62,3,4,5,6,7,18,9,10,11,12,123,148,152,
                           40,71,72,3,4,5,6,7,8,9,10,11,12,143,146,153,
                           50,81,82,3,4,5,6,7,28,92,10,11,12,135,142,154,
                           60,91,92,3,4,5,6,7,8,9,10,11,12,137,154,155,
                           70,1,20,3,4,5,6,7,8,9,130,11,12,138,142,156,
                           80,21,62,3,4,5,6,7,28,9,150,11,12,193,154,157,
                           90,31,22,3,4,5,6,7,8,9,10,11,12,113,174,158,
                           0,41,2,43,4,5,6,7,8,9,103,11,12,133,146,159,
                           10,11,2,23,4,5,6,7,8,9,10,11,12,113,144,115,
                           20,31,2,33,4,5,6,7,18,9,101,11,12,123,142,152,
                           30,41,2,43,4,5,6,7,98,9,10,11,12,133,141,153};

    uint8_t pix1[16*16] = {0,11,22,33,44,55,66,77,88,99,10,111,12,13,14,15,
                           10,21,32,43,54,65,76,87,98,9,110,11,12,13,14,15,
                           20,31,42,53,64,75,86,97,8,19,120,11,12,13,14,15,
                           10,21,42,34,44,55,66,77,88,99,110,11,142,13,14,15,
                           60,91,92,3,4,5,6,7,8,9,10,11,12,13,15,115,
                           70,1,20,3,4,5,6,7,8,9,130,11,12,13,142,126,
                           80,21,62,3,4,5,6,7,28,9,150,11,12,193,154,117,
                           20,41,52,3,4,5,6,7,8,9,10,11,12,113,149,121,
                           30,61,62,3,4,5,6,7,18,9,10,11,12,123,148,92,
                           40,71,72,3,4,5,6,7,8,0,10,11,12,123,146,13,
                           50,81,82,3,4,5,6,7,2,92,10,1,12,125,142,14,
                           90,31,22,3,4,5,6,7,8,9,10,11,12,13,174,18,
                           0,41,2,43,4,5,6,7,8,9,103,11,12,123,146,19,
                           10,11,2,23,4,5,6,7,8,9,10,11,12,113,14,11,
                           20,31,2,33,4,5,6,7,8,9,101,11,12,13,12,12,
                           30,41,2,43,4,5,6,7,92,9,10,11,12,13,11,13};

    uint8_t pix2[16*16] = {0,11,22,33,44,55,66,77,88,99,10,111,12,13,14,15,
                           10,21,32,43,54,65,76,87,98,9,110,11,12,13,14,15,
                           20,31,42,53,64,75,86,97,8,19,120,11,12,13,14,15,
                           10,21,42,34,44,55,66,77,88,99,110,11,142,13,14,15,
                           60,91,92,3,4,5,6,7,8,9,10,114,122,13,15,115,
                           70,1,20,3,4,5,6,7,8,9,130,113,121,13,142,126,
                           80,21,62,3,4,5,6,7,28,9,150,11,12,193,154,117,
                           20,41,52,3,4,5,6,7,8,9,10,11,12,113,149,121,
                           30,61,62,3,4,5,6,7,18,9,10,11,12,123,168,92,
                           40,71,72,3,4,5,6,7,8,0,10,11,126,123,149,13,
                           50,81,82,3,4,5,6,7,2,92,10,1,127,125,142,14,
                           90,31,22,3,4,5,6,7,8,9,10,11,129,13,194,18,
                           0,41,2,43,4,5,6,7,8,9,103,11,12,193,196,19,
                           10,11,2,23,4,5,6,7,8,9,10,11,12,113,14,11,
                           20,31,2,33,4,5,6,7,8,9,101,11,12,13,12,12,
                           30,41,2,43,4,5,6,7,92,9,10,11,12,13,11,13};

    uint8_t pix3[16*16] = {0,11,22,33,44,55,66,77,88,99,10,111,12,13,14,15,
                           10,21,32,43,54,65,76,87,98,9,110,11,12,13,14,15,
                           20,31,42,53,64,75,86,97,8,19,120,11,12,13,14,15,
                           10,21,42,34,44,55,66,77,88,99,110,11,142,13,14,15,
                           60,91,92,3,4,5,6,7,8,9,10,114,122,13,15,115,
                           70,1,20,3,4,5,6,7,8,9,130,113,121,13,142,126,
                           80,21,62,3,4,5,6,7,28,9,150,11,12,193,154,117,
                           20,41,52,3,4,5,6,7,84,95,10,11,12,113,149,121,
                           30,61,62,3,4,5,6,7,183,9,10,11,12,123,168,92,
                           40,71,72,3,4,5,6,7,8,0,10,11,126,123,149,13,
                           50,81,82,3,4,5,6,7,2,92,10,1,127,125,142,14,
                           90,31,22,3,4,5,6,7,8,92,10,11,129,13,194,18,
                           0,41,2,43,4,5,6,7,8,91,103,11,12,193,196,19,
                           10,11,2,23,4,5,6,7,8,9,10,11,12,113,14,11,
                           20,31,2,33,4,5,6,7,8,9,101,11,12,13,12,12,
                           30,41,2,43,4,5,6,7,92,9,10,11,12,13,11,13};

    int scores_temp[4] = {10370, 7067, 8000, 849};
    int scores[4] = {0,0,0,0};

int main(void)
{
	//uint8_t pix0[16*16];
    //uint8_t pix1[16*16];
    //uint8_t pix2[16*16];
    //uint8_t pix3[16*16];
    //int scores[4];
	int i_stride = 16;
	int i;

	for(i=0; i<1000; i++)
		x264_pixel_sad_x4_16x16(&fenc, &pix0, &pix1, &pix2, &pix3, i_stride, scores);
	for (i = 0; i < 4; i++)
	{
        if (scores[i] != scores_temp[i]){
            #ifdef C
            printf("Failed to Complete: %d\n", 100*i);
            #endif
            return 100*i;
        }
	}

    #ifdef C
    printf("Success!!!\n");
    #endif
    return -1;
}
