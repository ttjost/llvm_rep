#cp $1 $1.old
perl -pi -e 's/\t\.text\n/\.section \.text\n/' $1
perl -pi -e 's/\t\.data\n/\.section \.data\n/' $1

sed -i -e 's/\.rodata.*/\.data /g' $1
sed -i -e 's/\.bss.*/\.bss \.section \.data/g' $1
sed -i -e 's/\.comm/\.section \.data  \.comm /g' $1

# Replace LOADS
perl -pi -e 's/(ldw)+([0-9])+ (.*) = ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\]/asm\,$2 $3 = $5, $4/' $1
perl -pi -e 's/(ldh)+([0-9])+ (.*) = ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\]/asm\,1$2 $3 = $5, $4/' $1
perl -pi -e 's/(ldhu)+([0-9])+ (.*) = ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\]/asm\,3$2 $3 = $5, $4/' $1
perl -pi -e 's/(ldb)+([0-9])+ (.*) = ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\]/asm\,2$2 $3 = $5, $4/' $1
perl -pi -e 's/(ldbu)+([0-9])+ (.*) = ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\]/asm\,4$2 $3 = $5, $4/' $1

# Replace STORES
perl -pi -e 's/(stw)+([0-9])+ ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\] = (.*)/asm\,$2 $4, $3, $5/' $1
perl -pi -e 's/(sth)+([0-9])+ ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\] = (.*)/asm\,1$2 $4, $3, $5/' $1
perl -pi -e 's/(stb)+([0-9])+ ([+-]?(?<!\.)\b[0-9]+\b(?!\.[0-9]))\[(.*)\] = (.*)/asm\,2$2 $4, $3, $5/' $1
